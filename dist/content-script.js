(()=>{class e{constructor(){this.hasUnsavedData=!1,this.formChangeTimeout=null,this.lastActivityTime=Date.now(),this.initialize()}initialize(){"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage.addListener((e,t,n)=>(this.handleMessage(e,t,n),!0)),this.setupFormMonitoring(),this.setupActivityMonitoring(),this.checkFormData()}handleMessage(e,t,n){"CHECK_FORM_DATA"===e.type?(this.checkFormData(),n({hasUnsavedData:this.hasUnsavedData})):n({error:"Unknown message type"})}setupFormMonitoring(){document.addEventListener("input",e=>{const t=e.target,n=t.tagName?t.tagName.toLowerCase():"";["input","textarea","select"].includes(n)&&this.handleFormChange(t)},{passive:!0}),document.addEventListener("submit",()=>{this.hasUnsavedData=!1,this.notifyBackgroundFormState()}),window.addEventListener("beforeunload",e=>{if(this.hasUnsavedData)return e.returnValue="You have unsaved changes. Are you sure you want to leave?",e.returnValue})}setupActivityMonitoring(){["click","keydown","scroll","mousemove","touchstart"].forEach(e=>{document.addEventListener(e,()=>this.handleUserActivity(),{passive:!0,capture:!0})}),window.addEventListener("focus",()=>this.handleWindowFocus()),window.addEventListener("blur",()=>this.handleWindowBlur()),document.addEventListener("visibilitychange",()=>this.handleVisibilityChange())}handleFormChange(e){this.formChangeTimeout&&clearTimeout(this.formChangeTimeout),this.formChangeTimeout=setTimeout(()=>{this.checkFormData()},500)}checkFormData(){const e=this.detectUnsavedFormData();e!==this.hasUnsavedData&&(this.hasUnsavedData=e,this.notifyBackgroundFormState())}detectUnsavedFormData(){const e=document.querySelectorAll("input, textarea, select");for(let t=0;t<e.length;t++){const n=e[t];if(("INPUT"!==n.tagName||!["submit","button","reset","hidden","search"].includes(n.type))&&this.isElementModified(n))return!0}const t=document.querySelectorAll('[contenteditable="true"]');for(let e=0;e<t.length;e++)if(t[e].innerText&&t[e].innerText.trim().length>0)return!0;return!1}isElementModified(e){if("INPUT"===e.tagName)switch(e.type){case"checkbox":case"radio":return e.checked!==e.defaultChecked;case"file":return e.files&&e.files.length>0;default:return e.value!==e.defaultValue&&""!==e.value.trim()}else{if("TEXTAREA"===e.tagName)return e.value!==e.defaultValue&&""!==e.value.trim();if("SELECT"===e.tagName)return 0!==e.selectedIndex}return!1}handleUserActivity(){const e=Date.now();e-this.lastActivityTime>5e3&&(this.lastActivityTime=e,this.notifyBackgroundActivity(e))}handleWindowFocus(){this.notifyBackgroundActivity(Date.now())}handleWindowBlur(){}handleVisibilityChange(){document.hidden||this.notifyBackgroundActivity(Date.now())}notifyBackgroundFormState(){if("undefined"!=typeof chrome&&chrome.runtime){const e={type:"FORM_DATA_DETECTED",hasUnsavedData:this.hasUnsavedData};chrome.runtime.sendMessage(e).catch(()=>{})}}notifyBackgroundActivity(e){if("undefined"!=typeof chrome&&chrome.runtime){const t={type:"PAGE_ACTIVITY",timestamp:e};chrome.runtime.sendMessage(t).catch(()=>{})}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>new e):new e})();